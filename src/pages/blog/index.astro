---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import { t } from '../../data/i18n';

const locale = 'en' as const;
const { site, faq } = t(locale);

const posts = (await getCollection('blog')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

function formatDate(dateStr: string) {
  return new Date(dateStr).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<Base title={`Blog — ${site.title}`} description="News, updates, and deep dives from the AgentMe protocol team." locale={locale} faqItems={faq.items} siteUrl={site.url} repoUrl={site.repoUrl}>
  <Nav locale={locale} />

  <section class="mx-auto w-full max-w-[1200px] px-6 pt-32 pb-16 md:pb-20 lg:pb-24">
    <div class="mb-12">
      <h1 class="text-3xl font-bold tracking-tight text-text-primary sm:text-4xl">
        Blog
      </h1>
      <p class="mt-3 text-lg text-text-secondary">
        News, updates, and deep dives from the AgentMe team.
      </p>
    </div>

    <div class="grid gap-6">
      {posts.map((post) => (
        <a
          href={`/blog/${post.id}`}
          class="group block rounded-xl border border-border bg-bg-card p-6 transition-all duration-200 hover:border-border-glow hover:bg-bg-secondary"
        >
          <div class="flex flex-col gap-3">
            <div class="flex items-center gap-3 text-sm text-text-muted">
              <time datetime={post.data.date}>{formatDate(post.data.date)}</time>
              <span>·</span>
              <span>{post.data.author}</span>
            </div>

            <h2 class="text-xl font-semibold text-text-primary transition-colors group-hover:text-accent-cyan sm:text-2xl">
              {post.data.title}
            </h2>

            <p class="text-text-secondary leading-relaxed">
              {post.data.description}
            </p>

            {post.data.tags && (
              <div class="flex flex-wrap gap-2 pt-1">
                {post.data.tags.map((tag: string) => (
                  <span class="rounded-full border border-border px-2.5 py-0.5 text-xs text-text-muted">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </a>
      ))}
    </div>
  </section>

  <Footer locale={locale} />
</Base>
