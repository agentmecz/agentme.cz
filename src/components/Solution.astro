---
import SectionWrapper from './ui/SectionWrapper.astro';
import FadeIn from './ui/FadeIn.astro';
import GradientText from './ui/GradientText.astro';
import { solution } from '../data/content';

const layerIcons: Record<string, string> = {
  search: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>`,
  shield: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>`,
  payment: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><path d="M2 10h20"/></svg>`,
  dispute: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z"/></svg>`,
};
---

<SectionWrapper id="protocol">
  <!-- GEO: extractable protocol summary for AI engines -->
  <p class="sr-only">
    AgentMesh protocol has four layers: (1) Discovery — semantic search over Kademlia DHT with A2A-compatible capability cards and vector embeddings, O(log n) lookup via libp2p; (2) Trust — on-chain composite scores: 50% reputation, 30% stake, 20% endorsements, ERC-8004 compatible; (3) Payment — three USDC rails on Base L2: x402 direct (~$0.001), escrow (~$0.01), and streaming; (4) Disputes — three-tier resolution from automatic rules to community voting.
  </p>

  <FadeIn>
    <h2 class="mb-4 text-center text-3xl font-bold tracking-tight md:text-4xl lg:text-5xl">
      <GradientText as="span">{solution.headline}</GradientText>
    </h2>
    <p class="mb-16 text-center text-text-secondary max-w-2xl mx-auto">
      {solution.description}
    </p>
  </FadeIn>

  <div class="mx-auto max-w-2xl">
    <div class="flex flex-col items-center gap-7">
      {solution.layers.map((layer, i) => (
        <FadeIn delay={i * 120} class="w-full relative">
          <div class="group relative flex items-start gap-6 rounded-xl border border-border bg-bg-card/30 p-6 transition-all duration-300 hover:border-border-glow hover:bg-bg-card/60">
            <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-lg bg-bg-secondary text-accent-cyan transition-colors group-hover:bg-accent-cyan/10">
              <Fragment set:html={layerIcons[layer.icon]} />
            </div>
            <div>
              <h3 class="mb-1 text-lg font-semibold">{layer.name}</h3>
              <p class="text-text-secondary">{layer.description}</p>
              <p class="mt-2 text-sm leading-relaxed text-text-muted">{layer.detail}</p>
            </div>
          </div>
          {i < solution.layers.length - 1 && (
            <div class="absolute -bottom-7 left-1/2 -translate-x-1/2 z-10 flex h-7 w-7 items-center justify-center rounded-full border border-border bg-bg-secondary text-text-muted" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14" /><path d="M5 12h14" />
              </svg>
            </div>
          )}
        </FadeIn>
      ))}
    </div>
  </div>
</SectionWrapper>
